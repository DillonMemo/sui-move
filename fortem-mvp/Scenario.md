# 유저 스토리

- **index**
    
    <aside>
    📖
    
    </aside>
    

---

---

# 1. 게임 자산 아이템 민팅

## **사용자로서**,

| As a | 권한 부여된 게임사 관리자 |
| --- | --- |
| I want | 아이템 민팅 템플릿(JSON 게임 아이템 메타 데이터 )을 작성해 게임 자산 아이템으로 민팅할 수 있다. |
| So that | 내가 만든 게임 아이템이 온체인 자산으로 등록되고, fortem에서 거래 및 인게임에서도 활용할 수 있다. |

## 허용 기준

- 권한이 부여된 게임사 관리자는 fortem에서  [민팅] 버튼을 통해 게임 자산 아이템 템플릿 등록 페이지로 이동해 등록 시작할 수 있어야 한다.
- 민팅 권한이 부여된 계정인지 사전 검증되어야 한다.
- 지갑이 연동되어 있지 않은 사용자가 템플릿 등록 페이지 진입 시 지갑 연동 팝업을 통해 sui 지갑을 연동해야 한다.
- 템플릿에는 게임 자산 아이템 메타데이터, 게임 속성, 거래 설정 값을 포함해야 한다.
    - **메타 데이터 (필수):** 아이템 명, 아이템 고유 식별 정보, 아이템 설명, 아이템 속성, 이미지 IPFS URL, 아이템 카테고리
    - **게임 속성 (일부 선택):** 호환 게임 목록, 희귀도, 기타 게임별 특수 속성
    - **거래 설정 값:** 판매금액(sui 토큰 기반 즉시구매가), 교환 허용 조건(아이템 카테고리 및 수량)
    
    ```rust
    Item {
      // === NFT 메타데이터 (필수) ===
      id, // 아이템 고유 ID (Ex.다른 메타데이터를 가진 같은 두 아이템의 고유 ID)
      collectionId, // 게임 고유 식별 정보
      metadata: {
        itemId, // 아이템 식별 ID (Ex. 다른 메타데이터를 가진 아이템이지만 같은 아이템 일 경우 고려)
        name,
        description,
        imageUrl, // 이미지 IPFS URL (Optional)
        rarity, // 희귀도
        ...
      }, // 아이템 속성(메타데이터)
      // === 게임 속성 (선택) ===
      compatibleGames, // 호환 게임 목록 (게임 ID 배열)
      gameSpecificAttributes, // 게임별 특수 속성
      // === 거래 설정 (선택) ===
      sellPrice, // 판매금액: sui 토큰 수량 (즉시구매가)
      acceptTradeCategories, // 교환 허용 아이템 카테고리 목록
      acceptTradeQuantities, // 교환 허용 아이템 수량
      // === 시스템 관리 ===
      escrow, // 실제 온체인 소유자 (마스터 권한 주소)
      status,  // 0=Minted, 1=Listed, 2=Swapped (Option)
    }
    ```
    
- 권한 부여된 게임사 관리자가 [아이템 생성] 버튼 클릭 시, 예상 가스비와 수수료가 표시되어야 한다.
    - 사용자 지갑 잔액이 가스비보다 적을 경우 경고 메시지가 노출되어야 한다.
- 권한 부여된 게임사 관리자가 [등록] 버튼을 클릭하면 `/api/` POST 요청을 보낼 수 있어야 한다.
- 요청이 성공하면 201 Created 응답과 함께 다음 데이터가 반환되어야 한다.
    - object-id, tx_hash, 입력한 메타 데이터, 민팅된 게임 자산 아이템 정보

## 테스트 시나리오

1. 권한이 부여된 게임사 관리자가 모든 필수 정보를 올바르게 입력 후 [등록] 버튼을 클릭하면 → 민팅 성공 → 응답 데이터에 object-id와 tx-hash가 포함됨 → ‘탐색’ 페이지에서 해당 게임 아이템 확인 가능.
2. 민팅 권한이 없는 사용자가 아이템 생성 시도 시 → 403 Forbidden과 함께 에러 메시지 반환
3. 필수 입력 값이 누락된 상태에서 요청하면 → 400 Bad Request와 함께 누락된 필드 정보 반환.
4. 온체인 민팅 실패 시 → 500 Internal Server Error와 함께 민팅 재시도 메시지 노출.
5. 지갑 잔액 부족 시 → 경고 메시지와 함께 민팅 진행 불가.

## DoD

- [ ]  민팅 권한 검증 로직 구현 (권한 부여된 계정만 민팅 가능)
- [ ]  민팅된 게임 자산 아이템이 온체인에 기록되고 object-id, tx-hash 생성됨
- [ ]  민팅 관련 메타데이터 및 상태 정보가 DB에 저장됨
- [ ]  마켓플레이스 ‘탐색’ 페이지에서 게임 자산 아이템이 노출됨
- [ ]  필수 입력값 유효성 검증 로직 동작 (스키마 불일치 시 400 반환 + 필드 하이라이트)
- [ ]  온체인 실패 케이스 발생 시 재시도 가이드 제공
- [ ]  지갑 잔액 검증 로직 구현 및 부족 시 경고 메시지 표시
- [ ]  QA 테스트 케이스 100% 통과

---

# 2. 게임 자산 아이템 구매 (토큰 즉시구매)

## **사용자로서**,

| As a | fortem 사용자(게임 플레이어 등) |
| --- | --- |
| I want | **fortem에 등록된 모든 게임 자산 아이템 중에서** 즉시구매가가 설정된 아이템을 선택해 토큰으로 구매할 수 있다. |
| So that | 내가 원하는 게임 아이템을 온체인으로 소유하고, 인게임 또는 플랫폼 내 교환에 활용할 수 있다. |

## 허용 기준

- 사용자는 fortem의 ‘탐색’ 페이지에서 모든 등록된 게임 자산 아이템을 확인할 수 있으며, 그 중 원하는 게임 자산 아이템을 선택할 수 있어야 한다.
- 즉시구매가(sellPrice)가 설정된 아이템만 [구매] 버튼이 활성화되어야 한다.
- 선택한 아이템의 ‘상세 페이지’에서는 상세 정보(메타 데이터, 게임 설정, 거래 설정 값)가 조회되어야 한다.
- 구매를 원하는 사용자는 [구매] 버튼 클릭 시, fortem에 로그인 되어 있어야 하며, 로그인이 되어 있지 않은 경우 로그인 팝업이 먼저 표시되어야 한다.
- 로그인 완료 후 지갑이 연동되어 있지 않다면 지갑 연동 팝업이 표시되어야 한다.
- [구매] 버튼 클릭 시 즉시 구매가, 플랫폼 수수료, 개발사 로얄티, 예상 가스비가 표시되어야 한다.
    - MVP 제약: 결제는 sui 토큰으로 이루어져야 한다.
- 사용자 지갑 잔액이 총 필요 금액보다 적을 경우 경고 메시지가 노출되어야 한다.
- 구매하려는 게임 자산 아이템이 현재 키오스크에서 거래 가능한 상태인지 검증되어야 한다.
- 사용자가 [구매 확인] 버튼을 클릭하면 `/api/` POST 요청을 보낼 수 있어야 한다.
    - 요청에는 `구매자 지갑 주소`, `item object-id`, `즉시 구매가 정보`가 포함된다.
- 구매 성공 시 201 Created 응답과 함께 다음 데이터가 반환되어야 한다.
    - `거래 tx_hash`, `구매자 지갑 주소`, `판매자 지갑 주소`, `item Object-ID`, `최종 소유자 정보`, `수수료 분배 내역(플랫폼 수수료, 개발사 로얄티)`
- 구매 완료 후, 해당 게임 자산 아이템은 에스크로에서 구매자 소유 지갑으로 온체인 전송되어야 한다.
- 구매한 게임 자산 아이템은 구매자의 fortem [내 인벤토리] 페이지에 자동 반영되어야 한다.

## 테스트 시나리오

1. **정상 구매:** 사용자가 지갑을 연결한 상태에서 즉시구매가가 설정된 아이템의 [구매하기]를 클릭하면 → 거래 성공 → 응답 데이터에 tx_hash와 소유권 정보가 포함됨 → [내 인벤토리]에서 해당 게임 자산 아이템 확인 가능하다.
2. 구매가가 설정되지 않은 게임 자산 아이템은 [구매] 버튼이 비활성화된다.
3. 구매자가 지갑을 연결하지 않은 상태에서 [구매하기] 버튼을 누르면 → '지갑 연결 필요' 메시지가 노출된다.
4. 잔액이 부족한 상태에서 구매를 시도하면 → 거래 실패 → ‘잔액 부족’ 에러 메시지가 반환된다.
5. 이미 다른 사용자가 구매한 게임 자산 아이템을 구매 시도하면 → '이미 판매된 상품' 메시지가 노출된다.
6. 온체인 트랜잭션 실패 시 → 500 Internal Server Error와 함께 ‘구매 실패’ 에러 메시지가 노출된다.
7. 판매 중이 아닌 게임 자산 아이템 구매 시도 시 → 400 Bad Request → '판매 중이 아닌 상품입니다' 메시지가 노출

## DoD

- [ ]  에스크로를 통한 구매 시스템 구현
- [ ]  구매 요청 시 tx_hash가 정상적으로 Sui 블록체인에 기록됨
- [ ]  에스크로 → 구매자 지갑으로 소유권 이전이 온체인에서 확인됨
- [ ]  플랫폼 수수료와 개발사 로얄티가 올바른 지갑으로 분배됨
- [ ]  [내 인벤토리] 페이지에 구매한 게임 자산 아이템이 노출됨
- [ ]  즉시구매가 설정 여부에 따른 구매 버튼 활성화/비활성화 로직 구현
- [ ]  게임 자산 아이템 판매 상태 검증 로직 구현
- [ ]  동시 구매 시도 시 적절한 처리 구현
- [ ]  잔액 부족, 지갑 미연동, 온체인 실패 등의 에러 케이스가 처리됨
- [ ]  QA 테스트 케이스 100% 통과

---

# 3. 게임 자산 아이템 판매 (거래 정보 등록)

## **사용자로서**,

| As a | fortem 사용자(게임 플레이어 등) |
| --- | --- |
| I want | 인게임에서 획득해 민팅된 게임 자산 아이템에 판매 정보를 설정하여 판매 가능한 상태로 전환할 수 있다. |
| So that | 내가 보유한 게임 자산 아이템을 다른 사용자에게 판매하거나 교환 제안을 받을 수 있다. |

## 허용 기준

- 로그인된 사용자는 fortem의 [내 인벤토리] 페이지에 진입할 수 있으며, 해당 페이지에서 보유한 게임 자산 아이템을 확인할 수 있어야 한다.
- 사용자가 판매하고자 하는 아이템을 선택하고 **[거래 정보 설정]** 버튼을 클릭하면 **거래정보 등록 팝업**이 노출되어야 한다.
- 거래정보 등록 팝업 진입 시, 지갑이 연동되어 있지 않은 경우 **지갑 연동 팝업**이 먼저 표시되어야 한다.
- 지갑 연동 완료 후, 해당 게임 자산 아이템이 사용자의 지갑에 실제로 소유되어 있는지 **온체인에서 검증**되어야 한다.
- 사용자는 거래 정보 등록 팝업에서 케이스 별로 다음 정보를 설정할 수 있어야 한다.
    - 신규 등록
        - 사용자는 sui 토큰 기반 고정 가격 정보를 설정해야 한다.
        - [등록 확인] 클릭 시 예상 가스비, 수수료(플랫폼 수수료율, 개발사 로얄티), 최종 판매자 수익액이 표시되어야 한다.
    - 가격 변경
        - 기 설정한 sui 토큰 기반 고정 가격정보를 확인할 수 있으며, 사용자는 현재가를 확인하고 신규 가격을 입력할 수 있어야 한다.
        - [변경 확인] 클릭시 예상 가스비, 변경 수수료(플랫폼 수수료율, 개발사 로얄티), 변경 최종 판매자 수익액이 표시되어야 한다.
- 사용자가 [등록] or [변경] 버튼을 클릭했을 때, 연동된 지갑 잔액이 가스비보다 적을 경우 **잔액 부족 경고 메시지**가 노출되어야 한다.
- 사용자가 정상적으로 [등록] 버튼을 클릭하면 `/api/` POST 요청을 보낼 수 있어야 한다.
    - 신규 등록: `소유자 지갑 주소`, `아이템 object-id`, `즉시판매가`, `교환 허용 조건` 포함
    - 가격 변경: `소유자 지갑 주소`, `아이템 object-id`, `변경_즉시판매가`, `교환 허용 조건` 포함
- 등록 성공 시 응답과 함께 다음 데이터가 반환되어야 한다.
    - 신규 등록: 201 Created → `아이템 object-id`, `등록된 판매 정보`, `수수료 구조(플랫폼 수수료, 개발사 로얄티, 최종 판매자 수익액)`, `키오스크 등록 상태`, `등록 시점`
    - 가격 변경: 200 OK → `아이템 object-id`, `변경된 판매 정보`, `수수료 구조(플랫폼 수수료, 개발사 로얄티, 최종 판매자 수익액)`, `키오스크 등록 상태`, `가격 변경 시점`, `tx_hash`
- 판매 등록 완료된 아이템은 **키오스크에 등록**되어 거래 가능한 상태가 되어야 한다.
- 등록된 아이템은 **[구매] 버튼이 활성화된 상태**로 fortem [탐색] 페이지에 노출되어야 한다.
    - 가격 수정 시, ‘탐색’페이지의 아이템 가격이 갱신된다.

## 테스트 시나리오

1. 정상등록: [내 인벤토리] 에서 게임 자산 아이템 선택 → [거래 정보 설정] → 가격정보 입력 후 [등록 확인] → 가스비, 수수료, 수익 표시 → [등록] 클릭 → 201 Created & `키오스크 상태=registered` → ‘탐색’페이지에 아이템 노출, [구매] 버튼 활성.
2. 등록 수정: [내 인벤토리]에서 이미 가격설정한 게임거래 아이템 선택 → [거래정보 설정] → 설정값 수정 → [등록확인] → 가스비, 수수료, 수익 표시 → [등록] 클릭 → 201 Created & `키오스크 상태=registered` → ‘탐색’페이지에 아이템이 수정된 가격정보로 노출, [구매] 버튼 활성.
3. **지갑 미연동**: 지갑 미연동 상태에서 [거래 정보 설정] 클릭 → “지갑 연결 필요” 팝업 노출 → 지갑 연동 완료 전까지 등록 불가.
4. **소유권 검증 실패**: 인벤토리에 보이는 아이템이 실제 온체인 지갑에 없을 경우 → 400 Bad Request & “아이템을 소유하지 않음” 메시지.
5. **즉시판매가 미설정**: 즉시판매가 미입력 상태에서 [등록] 클릭 → 400 Bad Request & “즉시판매가 입력 필요” 메시지.
6. **가스비 부족**: [등록 확인] 시 예상 가스비 > 지갑 잔액일 경우 → “가스비 부족” 메시지 & [등록] 버튼 비활성화.
7. **키오스크 등록 실패**: 온체인 트랜잭션 오류로 등록 실패 → 500 Internal Server Error & “등록 실패, 다시 시도” 메시지 + 재시도 가이드 제공.
8. **수수료/순수익 검증**: 즉시판매가 100 SUI 입력, 플랫폼 수수료 5%, 로얄티 2% → [등록 확인]에서 “플랫폼 수수료=5 / 로얄티=2 / 판매자 순수익=93” 정확히 표시 & 응답 데이터와 일치 확인.

## DoD

- [ ]  판매 등록/가격 변경 API가 정상 응답을 반환하고, 판매정보가 DB 및 온체인에 반영된다.
- [ ]  ‘탐색’페이지에서 등록 시 즉시노출, 가격 변경 시 즉시 갱신되는 것을 확인한다.
- [ ]  소유권 검증, 지갑 잔액 검증 등 핵심 검증 로직이 동작한다.
- [ ]  UI에 예상 가스비,수수료,순수익이 표시되고, 동일가 변경 시 제한된다.
- [ ]  QA 테스트 시나리오 100% 통과

---

# 4. 트레이드 준비 (트레이드 허용 조건 등록)

## **사용자로서**,

| As a | fortem 사용자(게임 플레이어 등) |
| --- | --- |
| I want | 내가 보유한 게임 자산 아이템에 대해 트레이드 허용조건(카테고리, 수량)을 설정하고 싶다. |
| So that | 다른 사용자가 내 아이템을 선택해 해당 조건에 맞는 교환 요청을 보낼 수 있다.  |

## 허용 기준

- fortem에 로그인된 사용자는 ‘내 인벤토리’ 페이지에 진입할 수 있으며, 해당 페이지에서 보유한 게임 자산 아이템을 확인할 수 있어야 한다.
- 사용자가 트레이드 조건을 설정하고 싶은 아이템을 선택하고, [거래정보 설정] 버튼을 클릭하면 거래정보 등록 팝업이 노출되어야 한다.
- 지갑이 연동되지 않은 경우, 팝업 진입 시 **지갑 연동 팝업**이 먼저 표시되어야 한다.
- 지갑 연동 완료 후, 해당 아이템이 실제 사용자의 소유인지 **온체인 검증**이 수행되어야 한다.
- 거래정보 등록 팝업에서 사용자는 트레이드 허용 조건을 선택적으로 입력할 수 있어야 한다.
    - 신규 등록
        - 조건 입력 시: 허용 카테고리 및 수량 값이 저장되어 해당 조건에 맞는 제안만 수락 가능.
        - 조건 미입력 시: 해당 아이템은 모든 아이템에 대해 오픈 상태로 등록되어, 어떤 카테고리 수량이든 제안할 수 있음.
        - [등록 확인] 클릭 시 예상 가스비가 표시되어야 한다.
    - 조건 변경
        - 기 설정된 트레이드 허용 조건을 확인할 수 있으며, 사용자는 카테고리 및 수량을 변경하거나 조건을 제거(null)하여 모든 아이템 제안 허용 상태로 전환할 수 있어야 한다.
        - [변경 확인] 클릭 시 예상 가스비가 표시되어야 한다.
- 사용자가 [등록] or [변경] 버튼을 클릭했을 때, 연동된 지갑 잔액이 가스비보다 적을 경우 잔액 부족 경고 메시지가 노출되어야 한다.
- 사용자가 정상적으로 버튼을 클릭하면 `/api/`POST 요청이 전송된다.
    - 신규 등록: `소유자 지갑 주소`, `아이템 object-id`, `허용 카테고리(nullable)`, `허용 수량(nullable)`
    - 조건 변경: `소유자 지갑 주소`, `아이템 object-id`, `변경_허용 카테고리(nullable)`, `변경_허용 수량(nullable)`
- 등록 성공 시 응답과 함께 다음 데이터가 반환된다.
    - 신규 등록: 201 Created → `아이템 object-id`, `트레이드 허용 조건(입력 없을 시 null)`, `키오스크 등록 상태`, `등록 시점`, `tx_hash`
    - 조건 변경: 200 OK → `아이템 object-id`, `변경된 트레이드 허용 조건(category/quantity 또는 null)`, `키오스크 등록 상태`, `가격/조건 변경 시점(updated_at)`, `tx_hash`
- 트레이드 허용 조건이 설정 or 미설정된 아이템은 fortem ‘탐색’페이지에 노출되어야 한다.
    - 조건이 있을 경우 → 조건 내용 표시
    - 조건이 없을 경우 → 모든 아이템 제안 허용 상태로 표시
    - 조건 변경 시 → 상세 표시가 즉시 갱신됨
- **MVP 제약:** 등록된 아이템은 **아이템↔아이템 교환만 허용한다.**

## 테스트 시나리오

1. **정상 등록 (조건 있음)**: 내 인벤토리 페이지에서 아이템을 선택 → [거래정보 설정] → 카테고리 및 수량 입력 → [등록 확인]에서 예상 가스비 표시 → [등록] → 201 Created → 탐색 페이지 리스트에 조건 노출.
2. **정상 등록 (조건 없음)**: 내 인벤토리 페이지에서 아이템을 선택 → [거래정보 설정] → 카테고리 및 수량 미입력 → [등록 확인]에서 예상 가스비 표시 → [등록] → 201 Created → 탐색 페이지 리스트에 모든 아이템 허용 노출
3. **조건 변경 (값 수정):** 내 인벤토리 페이지에서 아이템을 선택 → [거래정보 설정] → 카테고리 및 수량  수정 → [등록 확인]에서 예상 가스비 표시 → [등록] → 200 OK → 탐색, 상세페이지에서 즉시 조건 갱신
4. **조건 해제 (오픈 전환):** 내 인벤토리 페이지에서 아이템을 선택 → [거래정보 설정] → 기존 조건 null → [등록 확인]에서 예상 가스비 표시 → [등록] → 200 OK (조건null) → 탐색, 상세페이지에서 모든 아이템 제안 허용
5. **동일 값 변경 불가:** 기존과 동일한 카테고리,수량으로 [변경] → 팝업 인라인 에러 문구 노출 및 저장불가 메시지 노출
6. **지갑 미연동**: 지갑 미연동 상태로 등록 시도 → “지갑 연결 필요” 메시지 노출 & 요청 차단.
7. **가스비 부족:** [등록 확인] 시 예상 가스비 노출 → 지갑잔액이 미달할 경우 → 가스비 부족 메시지 노출 및 등록 진행 불가.
8. **거래 중 아이템**: 이미 거래 중인 아이템 등록 시도 → ‘진행 중 거래로 등록 불가’ 메시지 노출.

## DoD

- [ ]  트레이드 허용 조건 등록/변경 API가 정상 응답을 반환하고, 조건 정보가 DB 및 온체인에 반영됨
- [ ]  탐색 페이지에서 조건 등록/변경 시 즉시 반영되는 것을 확인 (조건 표시 또는 모든 아이템 허용 표시)
- [ ]  소유권 검증, 거래 진행 중 상태 검증, 지갑 잔액 검증 등 핵심 검증 로직이 동작
- [ ]  동일 조건 변경 시도 시 인라인 에러 처리 및 저장 차단 기능 구현
- [ ]  가스비 부족 시 경고 메시지 표시 기능 구현
- [ ]  허용 조건 nullable 처리 로직 구현 (조건 있음/없음 상태 관리)
- [ ]  키오스크 시스템과 연동하여 트레이드 허용 상태가 온체인에 반영됨
- [ ]  QA 테스트 케이스 100% 통과

---

# 5. 트레이드 수락 (교환 요청 수락/거절 및 실행)

## **사용자로서**,

| As a | fortem 사용자(게임 플레이어 등) |
| --- | --- |
| I want | 다른 사용자가 내 게임 자산 아이템에 보낸 교환 요청을 수락하거나 거절할 수 있다. |
| So that | 원할 경우에는 내 아이템과 상대 아이템을 키오스크를 통해 안전하게 교환할 수 있고, 원치 않을 경우 거절할 수 있다. |

## 허용 기준

- fortem에 로그인된 사용자는 ‘내 인벤토리’ 페이지의 ‘교환 요청’ 탭에서 다른 사용자들이 전송한 교환 제안들을 리스트 형태로 확인할 수 있어야 한다.
- 교환 제안 리스트에는 다음 정보가 간략히 표시되어야 한다.
    - 제안 정보: 번호 or id
    - 제안 아이템: 아이템명, 이미지, 수량
    - 대상 아이템: 아이템명, 이미지
    - 제안일시
    - [자세히 보기] 버튼
- 사용자가 [자세히 보기] 버튼을 클릭하면 상세 제안 내용 팝업이 노출되어야 한다.
- 상세 제안 내용 팝업에는 다음정보가 포함되어야 한다.
    - 제안자 정보: `지갑 주소`, `제안 시점`
    - 제안 아이템: `item object-id`, `아이템명`, `메타데이터`, `이미지`, `수량`
    - 대상 아이템: `item object-id`, `아이템명`, `메타데이터`, `이미지`
    - [수락] 및 [거절] 버튼
- 사용자는 상세 팝업에서 [수락] 또는 [거절]을 선택할 수 있어야 한다.
    - [수락] 선택 시
        - 지갑이 연동되지 않은 경우 지갑 연동 팝업이 먼저 표시되어야 한다.
        - 지갑 연동 완료 후 양쪽 게임 자산 아이템이 각각의 소유자 지갑에 실제로 존재하는지 온체인에서 검증되어야 한다.
        - [수락 확인] 클릭 시 예상 가스비가 표시되어야 한다.
        - 연동된 지갑 잔액이 가스비보다 적을 경우 경고 메시지가 노출되어야 한다.
        - [컨펌] 버튼 클릭 시 `/api/` POST 요청을 통해 키오스크 시스템에서 교환이 실행되어야 한다.
            - 요청 포함 데이터: `수락자 지갑 주소`, `제안자 지갑 주소`, `수락자 아이템 object-id`, `제안자 아이템 object-id`, `요청 ID`
        - 교환 성공 시 201 Created 응답과 함께 다음 데이터가 반환되어야 한다.
            - `tx_hash`, `교환된 두 아이템의 object-id`, `새로운 소유자 정보`, `교환 완료 시점`
        - 교환 수락 시, 동일 아이템에 대한 다른 모든 제안들이 자동으로 거절 상태로 변경되어야 한다.
            - 자동 거절된 제안들의 제안자들은 각각의 인벤토링 ‘교환요청’탭에서 거절 상태를 확인할 수 있다.
    - [거절] 선택 시
        - `/api/` POST 요청을 통해 거래 상태가 거절 상태로 변경되어야 한다.
            - 요청 포함 데이터: `거절자 지갑 주소`, `요청 ID`
        - 거절 성공시 200OK 응답과 함께 다음 데이터가 반환되어야 한다.
            - `요청 ID`, `거절 상태`, `거절 시점`
        - 거절된 내역은 제안자의 인벤토리’교환 요청’탭에서 확인 가능하며, 7일간 유지 후 자동 삭제된다.
- 교환 완료된 게임 자산 아이템은 양쪽 모두의 fortem ‘내 인벤토리’ 페이지에 즉시 반영되어야 한다.
- MVP 제약: **아이템↔아이템 교환만 허용한다.**

## 테스트 시나리오

1. **정상 교환**: 사용자가 교환 요청을 받고 지갑 연동 완료 후 [수락] → [컨펌] 클릭 → tx_hash 발급 & 키오스크를 통한 소유권 교환 완료 → 양쪽 인벤토리에 반영 → **동일 아이템에 대한 다른 모든 제안이 자동 거절**.
2. **거절 처리**: 요청 수신자가 [거절] 클릭 → 거절 상태 저장 → 제안자의 인벤토리 ‘교환 요청’ 탭에서 거절 상태 확인 가능.
3. **소유권 검증 실패**: 교환 실행 시점에 한쪽 아이템이 더 이상 소유자 지갑에 없을 경우 → 400 Bad Request & 아이템 소유권 검증 실패 메시지.
4. **이미 처리된 요청**: 이미 수락/거절된 요청을 다시 처리 시도 → 409 Conflict & 이미 처리된 요청 메시지.
5. **지갑 미연동**: 지갑 연결하지 않은 상태에서 [수락] 클릭 → 지갑 연동 팝업 표시 → 연동 완료 후 교환 진행.
6. **가스비 부족**: [컨펌] 클릭 시 지갑 잔액의 지불 가스비에 미달할 경우 → 가스비 부족 메시지 노출 및 교환 비진행
7. **키오스크 교환 실패**: 온체인 트랜잭션 오류로 교환 실패 → 500 Internal Server Error & 교환 실패 재시도 메시지.
8. **자동 거절 확인**: 특정 아이템 교환 수락 후 해당 아이템에 대한 다른 제안자들의 인벤토리에서 자동 거절 상태로 표시 확인.

## DoD

- [ ]  교환 요청 수락 시 키오스크 시스템을 통한 온체인 교환이 정상 실행되고 tx_hash가 기록됨
- [ ]  교환 완료 시 두 아이템의 소유권이 키오스크를 통해 안전하게 교환됨
- [ ]  특정 아이템에 대한 교환 수락 시, 해당 아이템에 대한 다른 모든 제안이 자동 거절 처리됨
- [ ]  교환 요청 거절 시 상태값이 저장되고 요청자 인벤토리에 반영됨(7일 후 자동 삭제)
- [ ]  자동 거절된 제안들이 각 제안자의 인벤토리에 올바르게 반영됨
- [ ]  교환 완료 결과가 양쪽 인벤토리에 실시간 반영됨
- [ ]  중복/만료된 요청에 대한 예외 처리
- [ ]  가스비 부족 시 경고 메시지 표시 및 버튼 비활성화 기능 구현
- [ ]  양쪽 아이템의 온체인 소유권 검증 로직 구현
- [ ]  QA 테스트 케이스 100% 통과

---

# 6.  트레이드 요청 (다른 사용자의 게임자산아이에 교환 요청 보내기)

## **사용자로서**,

| As a | fortem 사용자(게임 플레이어 등) |
| --- | --- |
| I want | fortem 탐색 페이지에서 다른 사용자의 게임 자산 아이템을 발견하고, 내가 소유한 아이템과 교환 요청을 보낼 수 있다. |
| So that | 상대방이 내 제안을 검토 및 수락할 경우 원하는 아이템을 서로 교환할 수 있다. |

## 허용 기준

- 사용자는 fortem의 ‘탐색’페이지에 리스트업되어 있는 게임 자산 아이템을 선택할 수 있어야 한다.
- 선택한 게임 자산 아이템의 상세 페이지에서 [트레이드] 버튼을 클릭할 수 있어야 한다.
    - 단, 대상 아이템 소유자와 제안자가 동일할 경우 요청이 차단되어야 한다.
- [트레이드] 클릭시, 사용자는 fortem에 로그인 되어 있어야 하며, 로그인이 되어 있지 않은 경우 로그인 팝업이 먼저 표시되어야 한다.
- 로그인 완료 후 지갑이 연동되어 있지 않은 경우 지갑연동 팝업이 표시되어야 한다.
- 지갑 연동 완료 후 교환 제안 팝업이 노출되어야 한다.
- 교환 제안 팝업에는 다음 정보와 기능을 제공한다.
    - **대상 아이템 정보:** 아이템명, 이미지, 메타데이터 표시
    - 내 제안 아이템 선택: 대상 아이템의 트레이드 허용 조건을 충족하는 내 소유 게임 자산 아이템만 필터링하여 표시함
        - 대상 아이템의 조건이 없을 경우: 내 모든 아이템 표시함
        - 대상 아이템의 조건이 있을 경우: 해당 조건(카테고리, 수량)에 맞는 내 아이템만 표시함
        - ‘교환 제안 중’ 상태의 아이템은 제외하고 표시
    - 조건 수량: 보유 아이템 수량이 2 이상일 경우, 수량 입력이 가능해야 한다.
    - 제안 메모: 상대방에게 전달할 메시지 입력 (선택사항)
    - [제안 보내기] 버튼
- 제안할 아이템을 선택하고 [제안 보내기] 버튼 클릭 시, 다음 검증이 수행되어야 한다.
    - 제안하는 게임 자산 아이템이 현재 요청자의 지갑에 실제로 소유되어 있는지 온체인 검증
    - 제안하는 게임 자산 아이템이 요청 시점에 트레이드 가능 상태인지 확인
- 검증 완료 후에는 가스비가 표시되어야 하며, 연동된 지갑 잔액이 가스비보다 적을 경우 경고메시지가 노출되어야 한다.
- 사용자가 [확인] 버튼을 클릭하면 `/api/` POST 요청을 보낼 수 있어야 한다.
    - 요청 포함 데이터: `요청자 지갑 주소`, `제안 아이템 object-id`, `대상 아이템 object-id`, `대상 소유자 지갑 주소`, `제안 메모(선택)`
- 요청 성공 시, 201 Created 응답과 함께 다음 데이터가 반환되어야 한다.
    - `request_id`, `제안 아이템 object-id`, `대상 아이템 object-id`, `요청 시점`, `tx_hash`
- 요청 완료 후, 제안한 아이템은 '교환 제안 중' 상태로 변경되어야 한다.
- 요청 완료 후, 다음과 같이 각 사용자의 fortem 인벤토리에 반영되어야 한다.
    - 대상 아이템의 소유자: ‘내 인벤토리 > 교환 요청’ 탭에 새로운 요청(대기중)으로 표시.
    - 제안자: ‘내 인벤토리 > 보낸 제안’ 탭에 제안 내역 및 상태(대기중, 수락됨, 거절됨) 으로 표시.

## 테스트 시나리오

1. **정상 요청(조건 있음):** 트레이드 조건이 설정된 게임 자산 아이템 선택 → 교환 제안 팝업에서 조건에 맞는 내 아이템만 표시 → 제안 진행 → 201 Created&request_id 발급
2. **정상 요청(조건 없음):** 트레이드 조건이 설정되지 않은 게임 자산 아이템 선택 → 교환 제안 팝업에 내 모든 아이템 표시 → 제안 진행 → 201 Created&request_id 발급
3. **자기 아이템 제안 차단:** 대상 아이템 소유자=제안 요청자 → [트레이드]버튼 클릭시 400에러&에러 메시지 노출
4. **로그인 미완료:** 로그인하지 않은 상태에서 [트레이드] 클릭 → 로그인 팝업 노출 → 로그인 완료 후 재시도
5. **지갑 미연동:** 지갑 연동하지 않은 상태에서 [트레이드] 클릭 → 지갑 연동 팝업 표시 → 연동 완료 후 재시도
6. **소유권 검증 실패:** 더 이상 소유하지 않은 게임 자산 아이템으로 교환 요청 → 400 Bad Request& 아이템 미소유 에러 메시지
7. **가스비 부족**: [확인] 클릭 시 지갑 잔액의 지불 가스비에 미달할 경우 → 가스비 부족 메시지 노출 및 제안실패
8. **정상 반영:** 요청 성공 후 대상자 및 제안자의 인벤토리 페이지 내 리스트 갱신
9. **온체인 검증 실패:** 게임 자산 아이템 소유권 온체인 검증 실패 → 500 Internal Server Error&소유권 검증 실패 에러 메시지

## DoD

- [ ]  교환 요청 시 request_id가 생성되고 DB에 저장되며 tx_hash가 온체인에 기록됨
- [ ]  제안 아이템이 '교환 제안 중' 상태로 변경되고 DB에 반영됨
- [ ]  대상 아이템 소유자의 [교환 요청] 탭에 요청 내용이 반영됨
- [ ]  제안자의 [보낸 제안] 탭에 제안 내역 및 상태 표시 기능 구현
- [ ]  교환 제안 팝업에서 대상 아이템의 트레이드 조건에 맞는 내 아이템만 필터링하여 표시하는 기능 구현
- [ ]  교환 제안 팝업에서 ‘교환 진행 중’ 아이템은 필터링하여 미노출 기능 구현
- [ ]  게임 자산 아이템 소유권 온체인 검증 로직 구현
- [ ]  아이템 상태 검증 로직 구현
- [ ]  가스비 부족 시 경고 메시지 구현
- [ ]  제안 메모 기능 구현
- [ ]  QA 테스트 케이스 100% 통과

---

# 7. 게임으로 내보내기 (NFT를 인게임 아이템으로 연동)

## **사용자로서**,

| As a | fortem 사용자(게임 플레이어 등) |
| --- | --- |
| I want | fortem에서 내가 보유한 게임 자산 아이템을 특정 게임으로 부분적으로 내보내 인게임 아이템으로 활용할 수 있다. |
| So that | fortem에서 보유 중인 게임 자산 아이템 중 일부를 실제 게임에 연동해 사용할 수 있다. |

## 허용 기준:

- fortem에 로그인된 사용자는 ‘내 인벤토리’ 페이지에 진입할 수 있으며, ‘내 인벤토리 > 아이템’탭에서 보유한 게임 자산 아이템(수량 포함)을 확인할 수 있어야 한다.
- 사용자는 원하는 아이템을 선택해 [게임으로 내보내기] 버튼을 클릭하면, 지갑이 연동되어 있지 않은 경우 지갑연동 팝업이 먼저 노출되어야 한다.
- 지갑 연동 후에는 선택한 아이템이 실제 사용자의 소유인지 온체인 검증되어야 한다.
- 검증 이후 [게임으로 내보내기] 클릭시, 인게임 연동 팝업이 노출되어야 한다.
- 인게임 연동 팝업에는 다음정보와 입력 필드가 표시되어야 한다.
    - 아이템 정보: 선택한 아이템명, 이미지, 메타데이터
    - 아이템 수량 컨트롤러: 보유 수량 중 일부만 선택 가능
    - 호환 가능 게임 목록: 해당 아이템 연동할 수 있는 게임만 표시
    - 사용자 게임 계정 정보 입력 필드: 연동 대상 게임의 계정 입력
- 사용자가 연동 게임, 내보낼 수량, 게임 계정 정보를 입력 후 [확인] 버튼을 클릭하면 예상 가스비가 표시되어야 한다.
- 연동된 지갑 잔액이 가스비보다 부족할 경우 잔액 부족 경고 메시지가 노출되어야 한다.
- 사용자가 내보내기 [확인] 버튼을 클릭하면 `/api/` POST 요청이 전송되어야 한다.
    - 요청 데이터: `사용자 지갑 주소`, `item object-id`, `내보내기 수량 정보`, `대상 게임 식별자`, `사용자 게임 계정 정보`
- 내보내기 성공시 201 Created 응답과 함께 다음 정보가 반환되어야 한다.
    - `item object-id`, `대상 게임 식별자`, `내보내기 수량 정보`, `내보내기 완료 시점`, `전송 상태`
- 게임사에는 다음 정보가 전송되어야 한다.
    - `item object-id`, `내보내기 수량 정보`, `사용자 게임 계정 정보`
- 내보내기 완료된 게임 자산 아이템은 fortem 인벤토리와 인게임 인벤토리에서 다음과 같이 동기화되어야 한다.
    - fortem 인벤토리
        - 전체 보유 수량은 유지되며, 연동 완료 수량과 미연동 수량이 구분 표시.
        - 연동완료 수량: 연동 완료 상태, 거래(판매,트레이드) 액션 불가
        - 미연동 수량: 미연동 상태, fortem 내 다른 액션(판매,트레이드) 가능
    - 인게임 인벤토리
        - 사용자 게임 계정 인벤토리에 내보낸 수량만큼 아이템이 노출.

## 테스트 시나리오

1. **정상 내보내기(부분 수량):** fortem 인벤토리에서 10개 보유한 아이템중 3개만 선택 → [게임으로 내보내기] 진행 → 201Created → fortem 인벤토리(연동완료 3, 미연동 7)& 인게임 계정에 3개 반영
2. **정상 내보내기 (전체 수량):** fortem인벤토리에서 5개 보유한 아이템 전체 선택 → 내보내기 완료 → fortem 인벤토리(연동완료 5, 미연동 0) & 인게임 계정에 5개 반영
3. **지갑 미연동:** 지갑을 연결하지 않은 상태에서 내보내기 시도 → 지갑 연결 필요 메시지 노출
4. **거래 중 아이템:** ‘거래 중’ 상태의 NFT 내보내기 시도 → 400 에러 → 거래 중 NFT는 내보낼 수 없다는 메시지 노출
5. **게임사 연동 실패:** 게임사 오류로 데이터 전송 실패 → 500 에러 → 연동 실패 메시지 노출
6. **온체인 검증 실패:** NFT 소유권 검증 실패 → 500에러 → 에러 메시지 노출
7. **가스비 부족**: [확인] 클릭 시 지갑 잔액의 지불 가스비에 미달할 경우 → 가스비 부족 메시지 노출 및 제안실패

## DoD

- [ ]  내보내기 요청 시 상태 DB에 저장되고 응답 tx_hash가 기록됨
- [ ]  NFT 소유권 온체인 검증 로직 구현
- [ ]  게임 호환 검증 로직 구현
- [ ]  거래중 아이템 내보내기 방어 로직 구현
- [ ]  게임사 API 연동 및 데이터 전송 로직 구현
- [ ]  게임 자산 아이템 상태 관리 로직 구현 (연동 완료, 잔여 수량 구분)
- [ ]  게임사 연동 실패시 에러처리
- [ ]  내보내기 이력 및 추적
- [ ]  QA 테스트 케이스 100% 통과

---

# 8. 인게임 민팅 (드랍 아이템 자산화)

## 사용자로서,

| As a | fortem 사용자(게임 플레이어 등) |
| --- | --- |
| I want | 인게임에서 드랍된 아이템을 획득한 뒤, NPC(보물창고)에 맡기는 액션을 통해 게임 자산 아이템으로 민팅되길 원한다. |
| So that | 내가 획득한 게임 아이템을 온체인 자산으로 증명하여 fortem 인벤토리에 등록하고, 마켓플레이스에서 거래할 수 있다. |

## 허용 기준

- fortem에 연동된 게임에서 아이템 드랍이 발생할 수 있으며, 이 때 아이템은 소유자가 없는 상태로 존재한다. (온체인 자산 아님)
- 인게임 플레이어가 아이템을 픽업하면 해당 아이템은 인게임 인벤토리에 귀속되며, 여전히 fortem 자산으로는 전환되지 않는다.
- 인게임 플레이어가 게임 내 NPC(보물창고)에게 해당 아이템을 맡기면 자산화 절차가 시작된다.
    - 이 시점에서 fortem 계정 연동 상태를 확인해야 하며, 연동되지 않은 경우 fortem 로그인/연동 팝업이 먼저 노출되어야 한다.
    - 계정 연동 오나료 후 게임사 클라이언트는 fortem API를 통해 민팅 요청을 전송해야 한다.
        - 요청 데이터: `게임 식별`값, `플레이어 계정 정보`, `아이템 메타데이터`, `민팅 요청 시점`, `플레이어 지갑 주소`
- fortem은 민팅 요청 시 다음 내용을 검증해야 한다.
    - 인게임 플레이어 게임 계정 ↔ fortem 계정 연동 상태 확인
    - 게임사 API 인증 토큰 유효성 확인
    - 해당 아이템이 이미 자산화(민팅)된 이력이 없는지
- 검증 완료 후 fortem은 `/api/` POST 요청을 통해 온체인에 게임 자산 아이템을 민팅해야 한다.
- 민팅 성공 시 응답과 함께 다음 데이터가 반환된다.
    - `게임 자산 object-id`, `tx_hash`, `민팅된 아이템 메타데이터`, `민팅 완료 시점`
- 민팅된 게임 자산 아이템은 fortem 탐색 페이지에도 노출되어야 한다.
    - 최초 민팅된 게임 자산 아이템은 가격정보가 없는 상태로 등록되며, [구매]버튼은 비활성화된다. 단, [트레이드]버튼은 활성화되어 교환 제안 수락은 가능하다.
    - 이후 사용자가 fortem의 ‘내 인벤토리’페이지에서 가격 정보 설정 시 fortem에서 [구매]버튼이 활성화되고, *인게임 인벤토리에서는 제거되어 인게임 사용 불가 상태가 된다.*
- 자산화된 게임 아이템은 fortem에서 해당 사용자의 인벤토리에 초기 상태인 ‘연동 완료’로 표시되며, 즉시 인게임에서도 사용 가능해야 한다.
- 이미 민팅된 아이템이 인게임에서 다시 드랍될 경우, 단순 게임 아이템으로만 존재하며 새 소유자가 NPC에 맡기기 전까지는 fortem에 자산화되지 않는다.
- MVP 제약: 인게임에서 민팅된 아이템은 게임 내 직접 트레이드 불가, fortem을 통해서만 트레이드 거래가 가능하다.

## 테스트 시나리오

- **정상 민팅(NPC 맡김 → 자산화):** 인게임에서 아이템 드랍 → 픽업 후 NPC에 맡김 → fortem API로 민팅 요청 → 검증 완료 → 201 Created & `object-id`, `tx_hash` 반환 → fortem 인벤토리에 ‘연동 완료’ 상태로 추가 & 탐색 페이지 노출([구매] 비활성화, [트레이드] 활성화)
- **계정 연동 불일치**: NPC에 아이템 맡김 시 fortem 계정 연동 안 된 상태 → fortem 로그인/연동 팝업 노출 → 연동 완료 후 다시 민팅 요청 진행.
- **게임사 인증 실패**: 잘못된 API 토큰으로 민팅 요청 → 401 Unauthorized & 인증 실패 메시지 노출
- **필수 정보 누락**: 요청 데이터에서 아이템 메타데이터 누락 → 400 Bad Request → 누락된 필드 정보 반환.
- **중복 민팅 방지**: 동일 아이템에 대해 이미 민팅 이력이 있을 경우 → 409 Conflict → “이미 자산화된 아이템” 에러 반환.
- **탐색 노출(구매 비활성화)**: 최초 민팅된 아이템은 fortem 탐색 페이지에 노출되나 가격정보가 없으므로 [구매] 버튼은 비활성화되고 [트레이드] 버튼만 활성화.
- **가격 설정 후 구매 허용**: 사용자가 fortem ‘내 인벤토리’에서 가격정보 설정 → [구매] 버튼 활성화 → 인게임 인벤토리에서 해당 아이템은 제거(인게임 사용 불가 상태).
- **재드랍 케이스**: 이미 민팅된 아이템이 인게임에서 다시 드랍 → 새 플레이어가 픽업해도 단순 게임 아이템으로만 존재 → NPC에 맡겨 민팅 요청 전까지 fortem에 자산화되지 않음.

## DoD

- [ ]  게임사 API 인증 및 권한 검증 로직 구현
- [ ]  NPC 맡김 시점 플레이어 계정 ↔ fortem 계정 연동 필수 검증 로직 구현
- [ ]  중복 민팅 방지 로직 구현
- [ ]  인게임 민팅 시 온체인에 기록되고 게임 자산 아이템이 정상 생성
- [ ]  민팅된 **게임 자산 아이템**이 플레이어 fortem 인벤토리에 자동 추가됨
- [ ]  fortem의 초기 상태를 ‘연동 완료’로 설정(인게임 사용 가능)
- [ ]  fortem 탐색 노출 정책 적용: 가격 미설정 시 [구매] 비활성화, [트레이드] 활성화
- [ ]  fortem 가격 정보 설정 시 [구매] 활성화 및 인게임 인벤토리에서 제거(사용 불가로 전환)
- [ ]  게임사 콜백/웹훅 동기화(민팅·상태변경 알림, 재시도/오류 재처리 포함)
- [ ]  게임사 클라이언트 요청 유효성 검증
- [ ]  게임사별 민팅 이력 추적
- [ ]  QA 테스트 케이스 100% 통과